# 宕机原因
## 排查顺序：
1、使用upyime确定重启时间  
2、sar命令确定宕机时间和前后性能(历史性能),    
重启的时候会显示这类信息：05:09:09 PM  LINUX RESTART
> cd /var/log/sa/  
cat sar20 | more  
sar -r -f sa24  
-u：输出CPU使用情况的统计信息  
-b：显示I/O和传送速率的统计信息  
-A:  显示所有  
-n DEV：显示网卡流量信息


2、检查/var/log/messages(由系统的systemd进程产生,定时任务产生的日志等)日志，等
> 定时日志的格式类型为  
Started Session 71 of user root，  
Removed slice User slice of root.  
Stopping User slice of root.  

```
修改/var/log/message的日志级别
通过系统命令，修改日志配置文件
systemd-analyze set-log-level notice
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
消息紧急程度排行：
emerg:该系统不可用
alert：需要立即修改
crit：紧急情况
err：错误信息
warning：预警信息
notice：具有重要性的普通条件
info：提供信息的消息
debug：不包含函数条件或问题的其他信息
none：没有重要级，通常用于排错
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
```
3、journalctl --list-boots （默认只有boot id为0的）
```
默认情况下 systemd-journald 服务只保存本次启动后的日志(重新启动后丢掉以前的日志)。此时 -b 选项是没啥用的。当我们把 systemd-journald 服务收集到的日志保存到文件中之后，就可以看到上一次机器的重启信息

systemd-journald 服务收集到的日志默认保存在 /run/log 目录中，重启系统会丢掉以前的日志信息。 我们可以通过两种方式让 systemd-journald 服务把所有的日志都保存到文件中，这样重新启动后就不会丢掉以前的日志。
方法一：创建目录 /var/log/journal，然后重启日志服务 systemd-journald.service。
方法二：修改配置文件 /etc/systemd/journald.conf，把 Storage=auto 改为 Storage=persistent，并取消注释，然后重启日志服务 systemd-journald.service。

方法一的详细操作
在 /var/log/ 下面创建名为 journal 的目录，并设置权限即可：
$ sudo mkdir /var/log/journal
$ sudo chown root:systemd-journal /var/log/journal
$ sudo chmod 2775 /var/log/journal
$ sudo systemctl restart systemd-journald.service
之后 /run/log 下面就没有 journal 的日志了，日志文件被保存在 /var/log/journal 目录下：
查看日志占据的磁盘空间
$ sudo journalctl --disk-usage
```

4、last
> 以下看所有的重启、关机记录  
last | grep reboot  
last | grep shutdown  
-x 显示系统关机，重新开机，以及执行等级的改变等信息  

5、/var/log/boot.log   
 记录系统启动时的日志信息，如果系统启动之后有什么异常可以查看该文件信息，该日志还有备份  
每重启一次都会在上面的日志中显示一次boot的信息，加日期后缀  

6、/var/log/dmesg也可以用 dmesg 命令来查看  
linux启动的时候，会在屏幕上显示许多与硬件有关的信息，这些信息记录在 /var/log/dmesg 文件中，  


7、lastlog记录所有用户的最近登录信息  




